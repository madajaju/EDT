<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Robots -->
    <meta name="robots" content="index, follow">

    <!-- Dynamic Title / Meta -->
    <title>Decreasing Ingestion Congestion with Intel Optane DCPMM | Embracing Digital Transformation</title>
    <meta name="description" content="In this episode, Darren talks about decreasing ingestion congestion using Intel’s Optane DC Persistent Memory, and the experiment he conducted with surprising results. It just might change the way we think about programming in the future.">
    
    
    <link rel="canonical" href="https://www.embracingdigital.org/en/episodes/edt-16/index.html">
    

    <!-- Hreflang alternates (optional: pass `langs` into the template) -->
    

    <!-- Preconnect & CSS -->
    <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="/css/styles.css" as="style">
    <link rel="stylesheet" href="/css/styles.css">

    <!-- Favicon -->
    <link rel="icon" href="/images/favicon.ico" sizes="32x32" type="image/x-icon">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Decreasing Ingestion Congestion with Intel Optane DCPMM | Embracing Digital Transformation">
    <meta property="og:description" content="In this episode, Darren talks about decreasing ingestion congestion using Intel’s Optane DC Persistent Memory, and the experiment he conducted with surprising results. It just might change the way we think about programming in the future.">
    <meta property="og:url" content="https://www.embracingdigital.org/en/episodes/edt-16/index.html">
    <meta property="og:image" content="https://embracingdigital.org/images/logo.png">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Decreasing Ingestion Congestion with Intel Optane DCPMM | Embracing Digital Transformation">
    <meta name="twitter:description" content="In this episode, Darren talks about decreasing ingestion congestion using Intel’s Optane DC Persistent Memory, and the experiment he conducted with surprising results. It just might change the way we think about programming in the future.">
    <meta name="twitter:image" content="https://embracingdigital.org/images/logo.png">

    <!-- Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-P4XHVE79DL"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){ dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-P4XHVE79DL');
    </script>

    <!-- Schema.org -->
    <script type="application/ld+json">
        {
            "@context":"https://schema.org",
            "@type":"Organization",
            "name":"Embracing Digital Transformation",
            "url":"https://embracingdigital.org/",
            "logo":"https://embracingdigital.org/images/logo.png",
            "sameAs":[
                "https://www.youtube.com/@embracingdigital",
                "https://www.linkedin.com/company/embracingdigital"
            ]
        }
    </script>
    <script type="application/ld+json">
        {
            "@context":"https://schema.org",
            "@type":"WebSite",
            "name":"Embracing Digital Transformation",
            "url":"https://embracingdigital.org/",
            "potentialAction":{
                "@type":"SearchAction",
                "target":"https://embracingdigital.org/en/search.html?query={query}",
                "query-input":"required name=query"
            }
        }
    </script>
</head>

<body>
<a class="skip-link" href="#content">Skip to content</a>

<header class="site-header" role="banner">
    <div class="header-inner">
        <!-- Brand -->
        <div class="brand">
            <a class="brand-link" href="//home/index.html" aria-label="Embracing Digital home">
                <img src="/images/logo.png" alt="Embracing Digital Transformation logo" class="site-icon">
                <span class="brand-text">
            <span class="brand-title">Embracing Digital</span>
          </span>
            </a>
        </div>
    </div>

    <nav id="primary-nav" aria-label="Primary">
        <ul>
            <li>
                <a href="//home/index.html" >Home</a>
            </li>

            <!-- Guidance (ordered by your weekly arc) -->
            <li class="dropdown">
                <!-- Keep URL as /shows/ to avoid breaking links; label it Guidance -->
                <a href="//shows/index.html"
                   aria-haspopup="true"
                   aria-expanded="false"
                >
                Guidance
                </a>
                <ul class="dropdown-menu" role="menu">
                    <li role="none">
                        <a role="menuitem" href="//briefs/index.html">
                            Embracing Digital This Week
                            <small class="nav-note">What changed (Mon)</small>
                        </a>
                    </li>
                    <li role="none">
                        <a role="menuitem" href="//dta/index.html">
                            Digital Transformation Architect
                            <small class="nav-note">How to think (Tue)</small>
                        </a>
                    </li>
                    <li role="none">
                        <a role="menuitem" href="//episodes/index.html">
                            Embracing Digital Transformation
                            <small class="nav-note">How others did it (Wed)</small>
                        </a>
                    </li>
                    <li role="none">
                        <a role="menuitem" href="//deepdive/index.html">
                            Digital Deep Dive
                            <small class="nav-note">What to do next (Thu · part of EDTW)</small>
                        </a>
                    </li>
                </ul>
            </li>

            <li><a href="//guests/index.html" >Guests</a></li>

            <li class="dropdown">
                <a href="//community.html"
                   aria-haspopup="true"
                   aria-expanded="false"
                >
                Community
                </a>
                <ul class="dropdown-menu" role="menu">
                    <li role="none">
                        <a role="menuitem" href="//community.html">
                            The Community
                            <small class="nav-note">Join the conversation</small>
                        </a>
                    </li>
                    <li role="none">
                        <a role="menuitem" href="//newsletter.html">
                            Newsletter
                            <small class="nav-note">Weekly recap &amp; links</small>
                        </a>
                    </li>
                    <li role="none">
                        <a role="menuitem"
                           href="https://www.patreon.com/embracingdigital"
                           target="_blank"
                           rel="noopener">
                            Membership (Patreon)
                            <small class="nav-note">Private briefings &amp; deeper access</small>
                        </a>
                    </li>
                    <li role="none">
                        <a role="menuitem"
                           href="https://www.linkedin.com/company/embracing-digital-transformation"
                           target="_blank"
                           rel="noopener">
                            LinkedIn
                            <small class="nav-note">Public updates</small>
                        </a>
                    </li>
                </ul>
            </li>

            <li><a href="//sponsors/index.html" >Sponsors</a></li>

            <li class="dropdown">
                <a href="//about.html"
                   aria-haspopup="true"
                   aria-expanded="false"
                >
                About
                </a>
                <ul class="dropdown-menu" role="menu">
                    <li role="none"><a role="menuitem" href="//about.html">About the Show</a></li>
                    <li role="none"><a role="menuitem" href="//host.html">Host: Dr. Darren Pulsipher</a></li>
                    <li role="none"><a role="menuitem" href="//sponsors/index.html">Sponsorship &amp; Contact</a></li>
                </ul>
            </li>

            <li><a href="//search.html" >Search</a></li>

            <li><a href="https://6704f0-2.myshopify.com/" target="_blank" rel="noopener">Shop</a></li>

            <li class="dropdown">
                <a href="#" aria-haspopup="true" aria-expanded="false">Languages</a>
                <ul class="dropdown-menu" role="menu">
                    <li role="none"><a role="menuitem" href="/ar/home/index.html">العربية</a></li>
                    <li role="none"><a role="menuitem" href="/de/home/index.html">Deutsch</a></li>
                    <li role="none"><a role="menuitem" href="/en/home/index.html">English</a></li>
                    <li role="none"><a role="menuitem" href="/fr/home/index.html">Français</a></li>
                    <li role="none"><a role="menuitem" href="/it/home/index.html">Italiano</a></li>
                    <li role="none"><a role="menuitem" href="/pt/home/index.html">Português</a></li>
                    <li role="none"><a role="menuitem" href="/ja/home/index.html">日本語</a></li>
                </ul>
            </li>
        </ul>
    </nav>
</header>



<a class="skip-link" href="#main">Skip to content</a>

<nav class="breadcrumbs" aria-label="Breadcrumb">
    <ol>
        <li><a href="../../../en/home/index.html">Home</a></li>
        <li><a href="../../../en/episodes/index.html">Episodes</a></li>
        <li aria-current="page">Episode 16: Decreasing Ingestion Congestion with Intel Optane DCPMM</li>
    </ol>
</nav>

<main id="main" role="main">
    <article class="episode-container" itemscope itemtype="https://schema.org/PodcastEpisode">

        <header id="one-episode">
            
                <link itemprop="url" href="https://www.embracingdigital.org/en/episodes/edt-16/index.html">
                <meta itemprop="mainEntityOfPage" content="https://www.embracingdigital.org/en/episodes/edt-16/index.html"/>
            

            <h1 id="episode-title" itemprop="name">
                <span class="episode-number">Episode 16</span>
                <span class="episode-title">Decreasing Ingestion Congestion with Intel Optane DCPMM</span>
            </h1>

            <p class="episode-meta">
                
                    <time datetime="2020-08-25" itemprop="datePublished">2020-08-25T00:00:00.000Z</time>
                
                <span itemprop="author" itemscope itemtype="https://schema.org/Person">
          <meta itemprop="name" content="Dr. Darren Pulsipher">
          Hosted by <span class="host-name">Dr. Darren Pulsipher</span>
        </span>
            </p>

            <meta itemprop="episodeNumber" content="16"/>
            <meta itemprop="inLanguage" content="en"/>
        </header>

        
            <section class="video-container" aria-label="Watch the episode"
                     itemprop="associatedMedia" itemscope itemtype="https://schema.org/VideoObject">
                <meta itemprop="name" content="Decreasing Ingestion Congestion with Intel Optane DCPMM Video">
                <meta itemprop="embedUrl" content="https://www.youtube.com/embed/url">
                <iframe
                        width="auto"
                        height="auto"
                        src="https://www.youtube.com/embed/url"
                        title="Decreasing Ingestion Congestion with Intel Optane DCPMM Video"
                        loading="lazy"
                        referrerpolicy="strict-origin-when-cross-origin"
                        allowfullscreen
                ></iframe>
            </section>
        

        
            <section class="podcast-container" aria-label="Listen to this episode"
                     itemprop="associatedMedia" itemscope itemtype="https://schema.org/AudioObject">
                <meta itemprop="name" content="Decreasing Ingestion Congestion with Intel Optane DCPMM Audio">
                <meta itemprop="contentUrl" content="https://share.transistor.fm/e/7ca179aa">
                <iframe
                        width="100%"
                        height="180"
                        frameborder="0"
                        scrolling="no"
                        src="https://share.transistor.fm/e/7ca179aa"
                        title="Decreasing Ingestion Congestion with Intel Optane DCPMM Audio"
                        loading="lazy"
                ></iframe>

                <p class="listen-note">
                    Explore more in the <a href="../../../en/episodes/index.html">episode archive</a>.
                </p>
            </section>
        

        <section class="show-summary" aria-label="Episode summary" itemprop="description">
            <h2>Summary</h2>
            <p>In this episode, Darren talks about decreasing ingestion congestion using Intel’s Optane DC Persistent Memory, and the experiment he conducted with surprising results. It just might change the way we think about programming in the future.</p>


            
                <nav class="tags" aria-label="Tags">
                    
                        <a href="../../../en/search.html?query=artificialintelligence"
                           itemprop="keywords">artificialintelligence</a>
                    
                        <a href="../../../en/search.html?query=machinelearning"
                           itemprop="keywords">machinelearning</a>
                    
                        <a href="../../../en/search.html?query=edgecomputing"
                           itemprop="keywords">edgecomputing</a>
                    
                        <a href="../../../en/search.html?query=datamanagement"
                           itemprop="keywords">datamanagement</a>
                    
                        <a href="../../../en/search.html?query=multicloud"
                           itemprop="keywords">multicloud</a>
                    
                        <a href="../../../en/search.html?query=zerotrust"
                           itemprop="keywords">zerotrust</a>
                    
                        <a href="../../../en/search.html?query=process"
                           itemprop="keywords">process</a>
                    
                        <a href="../../../en/search.html?query=technology"
                           itemprop="keywords">technology</a>
                    
                </nav>
            

            
                <div class="guests" aria-label="Guests">
                    
                        <span itemprop="actor" itemscope itemtype="https://schema.org/Person">
              <a href="../../../en/guests/darren-w-pulsipher/index.html" itemprop="url">
                <span itemprop="name">Darren W Pulsipher</span>
              </a>
            </span>
                    
                </div>
            
        </section>

        <section class="show-notes" aria-label="Show notes">
            <h2>Service Stack Details</h2>
<p>A customer in the automotive industry was having a hard time trying to effectively get information out of their cars and into their data center so that they could do machine learning and analytics. There has been research in this area, but only for a small number of cars, not the customer’s hundred million cars. When I looked at their whole service stack and how everything was coming into the data center, data ingestion became the clear issue: How do I ingest that much data, and how do I do it quickly?</p>
<h2>High Level Kafka Architecture Overview</h2>
<p>The customer wanted to use Kafka for their ingestion. Kafka is a broker than can scale well, and the key is that it can handle several producers, different consumers, and a lot of data. Using several Kafka brokers to place and land data in the most appropriate places offers great flexibility.</p>
<p>Kafka, however, was primarily designed for message sizes of about one to 10 kilobytes and the customer’s data was approximately 240 kilobytes per car.  There are work-arounds, but I wanted to bring the whole 240 kilobyte message into the Kafka bus so I could move it as I needed to.</p>
<h2>Performance Best Practices</h2>
<p>I looked at the performance best practices of others working with Kafka to see if I could scale it for my customer. Increasing the buffer size to accommodate the whole message is one fine-tuning solution, along with managing batch size for optimal performance. Another successful practice is spreading out the logs. The flexibility of Kafka would allow me to put the data into different topics. I can break the topics into several partitions that I can span over multiple drives.  The question is, then, how many drives am I spreading the Kafka logs over? In addition, I want the fastest drives possible.</p>
<p>An example I examined was LinkedIn. Their published numbers from a year ago are that they can handle 13 million messages a second, or 2.7 gigabytes per second. They say they have about 1,100 Kafka brokers and more than 60 on a cluster, so that’s a pretty big configuration.</p>
<h2>Automotive Space</h2>
<p>If I look at the customer’s raw numbers (1.6 million messages per second and 800 gigabytes per second), and compared them to LinkedIn, which is probably not optimized for 240 kilobytes, I come up with 44,000 brokers. If I optimized it, I could probably get down to 4,400 brokers, which is still 240 clusters. That’s a huge amount of machines, so I had to come up with a way to make things faster. With more optimization, I could probably get it down to 400 to 500 brokers, but I wanted to see what else I could do.</p>
<h2>Intel Optane DC Persistent Memory</h2>
<p>I looked to our Optane Persistent Memory. It fits in a DDR4 format, so it sits right on the DDR4 bus. It goes up to 512 gigabyte modules, so in one two-socket server, I can have six terabytes of persistent memory. I wanted to figure out a way to leverage this highly reliable technology with great features such as built-in hardware encryption to help me solve this problem.</p>
<h2>Support for Breadth of Applications</h2>
<p>There are two modes of operation with this Optane Memory: direct app mode and memory mode. The memory mode is simple. It uses the persistent memory as normal RAM because it’s cheaper than normal DDR4. It&#39;s not the same as DDR4, but it’s close enough so that in most applications, you can’t see a difference.  In app direct mode, you can actually write from your program directly into persistent memory. This way, I don’t have to marshal and unmarshal data structures and stream them; I can just push them into persistent memory. I can also mount app direct mode as a file system so it’s on the memory bus, which is much faster than on the IO bus. Now, what can I do with this memory?</p>
<h2>Using Linux Kernel</h2>
<p>There are two primary tools available using the Linux kernel: ndctl and ipmctl. Ndctl is a non-volatile memory device controller, and then there is IPM, the Intel Persistent Memory controller, which lets me manipulate and control this persistent memory. I can set it up in the memory mode or app direct mode.  I had a bit to learn about these tools and how they work.</p>
<h2>Ingestion Approach</h2>
<p>My first thought was that if I gave Kafka a lot more memory with large buffer sizes, it should run a lot faster. Code changes in the configuration would be unnecessary or minimal.  Another option was changing Kafka to write to persistent memory rather than writing to a file system, bypassing the hard drive. The last thing I looked at was creating a persistent file system using persistent memory and then putting the Kafka logs on this new file system.</p>
<p>The easiest of the three options was the first – more memory. I ran all my tasks with more memory, and there was no change in performance. The reasons why is because eventually my buffers filled up and I had to ride out to a drive. Everything ultimately had to go to the Kafka logs, which was my bottleneck.</p>
<p>The second option involves rewriting code and waiting on approvals, so I jumped to the third option. The results of this experiment where I pointed the logs to this new, ultra-fast file system, were fascinating. Let’s take a look at the process and the results.</p>
<h2>Testing Constraints</h2>
<p>To remove obstacles to testing performance, I took network out of the equation by running my test on the same machine that my broker was on. Also, I only ran producers, then only consumers, then mixed, so I could weigh the differences. My goal was not to look at total production improvement, but at an individual broker to see if this drive would really make a difference.</p>
<h2>First Approach 50/50</h2>
<p>The first thing I did was take half of my persistent memory into app direct mode and turned it into a file system. I left the other half as memory. I used the commands ndctl and ipmctl and created name spaces. I mounted these file systems and ran my test.</p>
<h2>Changing Message Size</h2>
<p>I ran the tests over several different message sizes. I was expecting certain optimization, primarily for 1 kilobyte. I saw that I got better and better performance up to around 10 producers. Past 10 producers, I started saturating the bus and getting some variability. That tells me I was cashing things. I could now compare these numbers to what I ran before on just a SATA drive for the Kafka logs. I also tried our Optane NVMe drives for the logs.</p>
<h2>Technology Comparison</h2>
<p>Let’s take a look at the differences. For 240 kilobyte, with a normal SATA drive, it’s pretty flat. I got some improvement, and then it decreased as the number of producers increased. With the Optane NVMe drive, I got a nice peak, almost twice as fast as a SATA drive, which is what I would expect because it&#39;s an NVMe bus instead of a SATA bus. The Pmem is almost five times faster than a SATA drive and two and a half times faster than the Optane NVMe drive. That’s because I’m using a memory bus instead of the SATA or NVMe bus.</p>
<h2>Additional Optimization (100% App Direct)</h2>
<p>This was running fast and I was quickly filling up this temporary 750 GB drive. Since I needed to run the test a little longer, I went back and reconfigured my machine to do a 100 percent direct app mode so that I could now take the whole 1.5 terabytes.</p>
<h2>Optimized PMEM and 100% App Direct</h2>
<p>After I did this and ran the same tests, I got a surprising result. I could add more producers, and my throughput went up almost another two or three times. Now it’s between 12 and 15 times faster than a SATA drive at 25-30 producers at 240 kilobytes message size. This is incredible and would greatly reduce my customer’s need for so many brokers, rows and rows of machines. I ran the test several times because I didn’t believe the results I was getting. I called one of our architects that designed this technology and learned that one reason for the increased speed was when I was using part of the persistent memory as memory, the data would have to go through two or three hops that are not necessary with app direct mode. That creates less contention on the memory bus, and the throughput went up dramatically.</p>
<h2>Call to Action</h2>
<p>The end result is that I was able to use Kafka with Optane DC Persistent Memory as an ultra-fast file system to get major improvements in throughput on both producers and consumers.  A single broker can handle 15 times more messages and throughput than before, decreasing the number of servers required to handle large, complex system architectures. It’s time to evaluate your current architecture and see if this would benefit your organization.</p>

        </section>

        

    </article>
</main>

<!-- Structured Data -->
<script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "PodcastSeries",
  "@id": "https://www.embracingdigital.org/en/episodes/index.html#series",
  "name": "Embracing Digital Transformation",
  "url": "https://www.embracingdigital.org/en/episodes/index.html",
  "inLanguage": "en",
  "description": "A podcast about the digital transformation of the world.",
  "publisher": {
    "@type": "Organization",
    "@id": "https://www.embracingdigital.org/#org",
    "name": "Embracing Digital Transformation",
    "url": "https://www.embracingdigital.org",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.embracingdigital.org/images/logo.png",
      "width": 512,
      "height": 512
    }
  }
}</script>
<script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "PodcastEpisode",
  "@id": "https://www.embracingdigital.org/en/episodes/edt-16/index.html#episode",
  "url": "https://www.embracingdigital.org/en/episodes/edt-16/index.html",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.embracingdigital.org/en/episodes/edt-16/index.html"
  },
  "name": "Decreasing Ingestion Congestion with Intel Optane DCPMM",
  "episodeNumber": 16,
  "datePublished": "2020-08-25",
  "inLanguage": "en",
  "description": "In this episode, Darren talks about decreasing ingestion congestion using Intel's Optane DC Persistent Memory, and the experiment he conducted with surprising results. It just might change the way we think about programming in the future.",
  "partOfSeries": {
    "@id": "https://www.embracingdigital.org/en/episodes/index.html#series"
  },
  "author": {
    "@type": "Person",
    "name": "Dr. Darren Pulsipher"
  },
  "creator": {
    "@type": "Person",
    "name": "Dr. Darren Pulsipher"
  },
  "image": {
    "@type": "ImageObject",
    "url": "https://www.embracingdigital.org/en/episodes/edt-16/thumbnail.png"
  },
  "associatedMedia": [
    {
      "@type": "VideoObject",
      "name": "Decreasing Ingestion Congestion with Intel Optane DCPMM Video",
      "embedUrl": "https://www.youtube.com/embed/url"
    },
    {
      "@type": "AudioObject",
      "name": "Decreasing Ingestion Congestion with Intel Optane DCPMM Audio",
      "contentUrl": "https://share.transistor.fm/e/7ca179aa"
    }
  ],
  "actor": [
    {
      "@type": "Person",
      "name": "Darren W Pulsipher",
      "url": "https://www.embracingdigital.org/../../../en/guests/darren-w-pulsipher/index.html"
    }
  ]
}</script>

<footer id="footer">
    <div class="footer-content">
        <p>Copyright &copy; <span id="y"></span> Paidar Productions LLC</p>
        <p>All rights reserved</p>
    </div>
</footer>

<script>
    // year
    (function(){ var y=document.getElementById('y'); if(y){ y.textContent = new Date().getFullYear(); } })();

    // Guard for pages without nav
    const toggle = document.querySelector('.menu-toggle');
    const nav    = document.querySelector('nav#primary-nav');
    if (nav) {
        // Mobile: toggle .menu-open on <body>
        toggle?.addEventListener('click', () => {
            const open = document.body.classList.toggle('menu-open');
            toggle.setAttribute('aria-expanded', String(open));
        });

        // Dropdowns: tap/click + keyboard
        document.querySelectorAll('li.dropdown > a').forEach(link => {
            const li = link.parentElement;
            const submenu = li.querySelector('.dropdown-menu');

            link.addEventListener('click', (e) => {
                if (!submenu) return;
                e.preventDefault();

                // close others
                document.querySelectorAll('li.dropdown.open > a').forEach(a => {
                    if (a !== link) {
                        a.setAttribute('aria-expanded', 'false');
                        a.parentElement.classList.remove('open');
                    }
                });

                const isOpen = li.classList.toggle('open');
                link.setAttribute('aria-expanded', String(isOpen));
            });

            link.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowDown') { e.preventDefault(); submenu?.querySelector('a')?.focus(); }
                if (e.key === 'Escape')    { li.classList.remove('open'); link.setAttribute('aria-expanded','false'); link.focus(); }
            });
        });

        // Close dropdowns on outside click
        document.addEventListener('click', (e) => {
            if (!e.target.closest('nav')) {
                document.querySelectorAll('li.dropdown.open > a').forEach(a => {
                    a.setAttribute('aria-expanded','false');
                    a.parentElement.classList.remove('open');
                });
            }
        });
    }
</script>

