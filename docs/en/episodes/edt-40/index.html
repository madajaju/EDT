<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <base href="https://embracingdigital.org/" />

    <!-- Robots -->
    <meta name="robots" content="index, follow">

    <!-- Dynamic Title / Meta -->
    <title>Collaborative Medical Research with Confidential Computing | Embracing Digital Transformation</title>
    <meta name="description" content="Breakdown the barriers to accelerating medical research for the cure to cancer with confidential computing. Nick Bhadange, Technology Specialist, AI-Vets and Darren Pulsipher, Chief Solution Architect, Public Sector, Intel, discuss the need for confidential computing in healthcare and the potential">
    
    
    <link rel="canonical" href="https://www.embracingdigital.org/en/episodes/edt-40/index.html">
    

    <!-- Hreflang alternates (optional: pass `langs` into the template) -->
    

    <!-- Preconnect & CSS -->
    <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="css/styles.css" as="style">
    <link rel="stylesheet" href="css/styles.css">

    <!-- Favicon -->
    <link rel="icon" href="images/favicon.ico" sizes="32x32" type="image/x-icon">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Collaborative Medical Research with Confidential Computing | Embracing Digital Transformation">
    <meta property="og:description" content="Breakdown the barriers to accelerating medical research for the cure to cancer with confidential computing. Nick Bhadange, Technology Specialist, AI-Vets and Darren Pulsipher, Chief Solution Architect, Public Sector, Intel, discuss the need for confidential computing in healthcare and the potential">
    <meta property="og:url" content="https://www.embracingdigital.org/en/episodes/edt-40/index.html">
    <meta property="og:image" content="https://embracingdigital.org/images/logo.png">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Collaborative Medical Research with Confidential Computing | Embracing Digital Transformation">
    <meta name="twitter:description" content="Breakdown the barriers to accelerating medical research for the cure to cancer with confidential computing. Nick Bhadange, Technology Specialist, AI-Vets and Darren Pulsipher, Chief Solution Architect, Public Sector, Intel, discuss the need for confidential computing in healthcare and the potential">
    <meta name="twitter:image" content="https://embracingdigital.org/images/logo.png">

    <!-- Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-P4XHVE79DL"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){ dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-P4XHVE79DL');
    </script>

    <!-- Schema.org -->
    <script type="application/ld+json">
        {
            "@context":"https://schema.org",
            "@type":"Organization",
            "name":"Embracing Digital Transformation",
            "url":"https://embracingdigital.org/",
            "logo":"https://embracingdigital.org/images/logo.png",
            "sameAs":[
                "https://www.youtube.com/@embracingdigital",
                "https://www.linkedin.com/company/embracingdigital"
            ]
        }
    </script>
    <script type="application/ld+json">
        {
            "@context":"https://schema.org",
            "@type":"WebSite",
            "name":"Embracing Digital Transformation",
            "url":"https://embracingdigital.org/",
            "potentialAction":{
                "@type":"SearchAction",
                "target":"https://embracingdigital.org/en/search.html?query={query}",
                "query-input":"required name=query"
            }
        }
    </script>
</head>

<body>
<header class="site-header" role="banner">
    <div class="header-inner">
        <!-- Brand -->
        <div class="brand">
            <a class="brand-link" href="en/home/index.html" aria-label="Embracing Digital home">
                <img src="/images/logo.png" alt="Embracing Digital Transformation logo" class="site-icon">
                <span class="brand-text">
            </a>
        </div>
    </div>

    <nav id="primary-nav" aria-label="Primary">
        <!-- Main nav (left) -->
        <ul class="nav-main">
            <li>
                <a href="en/home/index.html"
                >
                Home
                </a>
            </li>

            <!-- Guidance (Shows / weekly arc) -->
            <li class="dropdown">
                <a href="en/shows/index.html"
                   aria-haspopup="true"
                   aria-expanded="false"
                >
                Guidance
                </a>
                <ul class="dropdown-menu" role="menu">
                    <li role="none">
                        <a role="menuitem" href="en/briefs/index.html">
                            Briefings (EDTW)
                            <small class="nav-note">What changed</small>
                        </a>
                    </li>
                    <li role="none">
                        <a role="menuitem" href="en/episodes/index.html">
                            Interviews (EDT)
                            <small class="nav-note">How others did it</small>
                        </a>
                    </li>
                    <li role="none">
                        <a role="menuitem" href="en/briefs/deepdives.html">
                            Architectural Deep Dives
                            <small class="nav-note">What to do next</small>
                        </a>
                    </li>
                </ul>
            </li>

            <!-- Learn (Documentation / learning library) -->
            <li class="dropdown">
                <a href="en/digital-transformation/index.html"
                   aria-haspopup="true"
                   aria-expanded="false"
                >
                Learn
                </a>
                <ul class="dropdown-menu" role="menu">
                    <li role="none">
                        <a role="menuitem" href="en/digital-transformation/index.html">
                            Digital Transformation
                            <small class="nav-note">Overview</small>
                        </a>
                    </li>
                    <li role="none">
                        <a role="menuitem" href="en/digital-transformation/pillars/index.html">
                            Pillars
                            <small class="nav-note">AI, Cyber, Data, Edge, Computing, Comms</small>
                        </a>
                    </li>
                    <li role="none">
                        <a role="menuitem" href="en/digital-transformation/odxa/index.html">
                            ODXA
                            <small class="nav-note">Domains &amp; mappings</small>
                        </a>
                    </li>
                    <li role="none">
                        <a role="menuitem" href="en/digital-transformation/whitepapers/index.html">
                            Whitepapers
                            <small class="nav-note">Monthly canonical synthesis</small>
                        </a>
                    </li>
                    <li role="none">
                        <a role="menuitem" href="en/digital-transformation/articles/index.html">
                            Articles
                            <small class="nav-note">Explainers &amp; analysis</small>
                        </a>
                    </li>
                    <li role="none">
                        <a role="menuitem" href="en/lectures/index.html">
                            Lectures (DTA)
                            <small class="nav-note">Learning series</small>
                        </a>
                    </li>
                </ul>
            </li>

            <!-- Community -->
            <li class="dropdown">
                <a href="en/community.html"
                   aria-haspopup="true"
                   aria-expanded="false"
                >
                Community
                </a>
                <ul class="dropdown-menu" role="menu">
                    <li role="none"><a role="menuitem" href="en/community.html">Community</a></li>
                    <li role="none"><a role="menuitem" href="en/newsletter.html">Newsletter</a></li>
                    <li role="none">
                        <a role="menuitem" href="https://www.patreon.com/embracingdigital" target="_blank" rel="noopener">
                            Patreon
                        </a>
                    </li>
                    <li role="none">
                        <a role="menuitem" href="https://www.linkedin.com/company/embracing-digital-transformation" target="_blank" rel="noopener">
                            LinkedIn
                        </a>
                    </li>
                </ul>
            </li>

            <!-- About (also holds Sponsors + Shop to keep top-level count low) -->
            <li class="dropdown">
                <a href="en/about.html"
                   aria-haspopup="true"
                   aria-expanded="false"
                >
                About
                </a>
                <ul class="dropdown-menu" role="menu">
                    <li role="none"><a role="menuitem" href="en/about.html">About</a></li>
                    <li role="none"><a role="menuitem" href="en/host.html">Host</a></li>
                    <li role="none"><a role="menuitem" href="en/sponsors/index.html">Sponsors</a></li>
                    <li role="none"><a role="menuitem" href="https://6704f0-2.myshopify.com/" target="_blank" rel="noopener">Shop</a></li>
                </ul>
            </li>

            <!-- Search -->
            <li>
                <a href="en/search.html"
                >
                Search
                </a>
            </li>
        </ul>

        <!-- Right side (Languages) -->
        <ul class="nav-right">
            <li class="dropdown">
                <a href="#" aria-haspopup="true" aria-expanded="false" aria-label="Select language">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle;">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="2" y1="12" x2="22" y2="12"></line>
                        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                    </svg>
                </a>
                <ul class="dropdown-menu" role="menu">
                    <li role="none"><a role="menuitem" href="ar/home/index.html">العربية</a></li>
                    <li role="none"><a role="menuitem" href="de/home/index.html">Deutsch</a></li>
                    <li role="none"><a role="menuitem" href="en/home/index.html">English</a></li>
                    <li role="none"><a role="menuitem" href="fr/home/index.html">Français</a></li>
                    <li role="none"><a role="menuitem" href="it/home/index.html">Italiano</a></li>
                    <li role="none"><a role="menuitem" href="pt/home/index.html">Português</a></li>
                    <li role="none"><a role="menuitem" href="ja/home/index.html">日本語</a></li>
                </ul>
            </li>
        </ul>
    </nav>
</header>



<a class="skip-link" href="#main">Skip to content</a>

<nav class="breadcrumbs" aria-label="Breadcrumb">
    <ol>
        <li><a href="../../../en/home/index.html">Home</a></li>
        <li><a href="../../../en/episodes/index.html">Episodes</a></li>
        <li aria-current="page">Episode 40: Collaborative Medical Research with Confidential Computing</li>
    </ol>
</nav>

<main id="main" role="main">
    <article class="episode-container" itemscope itemtype="https://schema.org/PodcastEpisode">

        <header id="one-episode">
            
                <link itemprop="url" href="https://www.embracingdigital.org/en/episodes/edt-40/index.html">
                <meta itemprop="mainEntityOfPage" content="https://www.embracingdigital.org/en/episodes/edt-40/index.html"/>
            

            <h1 id="episode-title" itemprop="name">
                <span class="episode-number">Episode 40</span>
                <span class="episode-title">Collaborative Medical Research with Confidential Computing</span>
            </h1>

            <p class="episode-meta">
                
                    <time datetime="2021-02-24" itemprop="datePublished">2021-02-24T00:00:00.000Z</time>
                
                <span itemprop="author" itemscope itemtype="https://schema.org/Person">
          <meta itemprop="name" content="Dr. Darren Pulsipher">
          Hosted by <span class="host-name">Dr. Darren Pulsipher</span>
        </span>
            </p>

            <meta itemprop="episodeNumber" content="40"/>
            <meta itemprop="inLanguage" content="en"/>
        </header>

        
            <section class="video-container" aria-label="Watch the episode"
                     itemprop="associatedMedia" itemscope itemtype="https://schema.org/VideoObject">
                <meta itemprop="name" content="Collaborative Medical Research with Confidential Computing Video">
                <meta itemprop="embedUrl" content="https://www.youtube.com/embed/url">
                <iframe
                        width="auto"
                        height="auto"
                        src="https://www.youtube.com/embed/url"
                        title="Collaborative Medical Research with Confidential Computing Video"
                        loading="lazy"
                        referrerpolicy="strict-origin-when-cross-origin"
                        allowfullscreen
                ></iframe>
            </section>
        

        
            <section class="podcast-container" aria-label="Listen to this episode"
                     itemprop="associatedMedia" itemscope itemtype="https://schema.org/AudioObject">
                <meta itemprop="name" content="Collaborative Medical Research with Confidential Computing Audio">
                <meta itemprop="contentUrl" content="https://share.transistor.fm/e/embracing-digital-transformation-episode44.html">
                <iframe
                        width="100%"
                        height="180"
                        frameborder="0"
                        scrolling="no"
                        src="https://share.transistor.fm/e/embracing-digital-transformation-episode44.html"
                        title="Collaborative Medical Research with Confidential Computing Audio"
                        loading="lazy"
                ></iframe>

                <p class="listen-note">
                    Explore more in the <a href="../../../en/episodes/index.html">episode archive</a>.
                </p>
            </section>
        

        <section class="show-summary" aria-label="Episode summary" itemprop="description">
            <h2>Summary</h2>
            <p>Breakdown the barriers to accelerating medical research for the cure to cancer with confidential computing. Nick Bhadange, Technology Specialist, AI-Vets and Darren Pulsipher, Chief Solution Architect, Public Sector, Intel, discuss the need for confidential computing in healthcare and the potential</p>


            
                <nav class="tags" aria-label="Tags">
                    
                        <a href="../../../en/search.html?query=confidentialcomputing"
                           itemprop="keywords">confidentialcomputing</a>
                    
                        <a href="../../../en/search.html?query=dataprivacy"
                           itemprop="keywords">dataprivacy</a>
                    
                        <a href="../../../en/search.html?query=healthcare"
                           itemprop="keywords">healthcare</a>
                    
                        <a href="../../../en/search.html?query=dataintegrity"
                           itemprop="keywords">dataintegrity</a>
                    
                        <a href="../../../en/search.html?query=security"
                           itemprop="keywords">security</a>
                    
                        <a href="../../../en/search.html?query=datamanagement"
                           itemprop="keywords">datamanagement</a>
                    
                        <a href="../../../en/search.html?query=analytics"
                           itemprop="keywords">analytics</a>
                    
                        <a href="../../../en/search.html?query=dataencryption"
                           itemprop="keywords">dataencryption</a>
                    
                        <a href="../../../en/search.html?query=cybersecurity"
                           itemprop="keywords">cybersecurity</a>
                    
                        <a href="../../../en/search.html?query=policy"
                           itemprop="keywords">policy</a>
                    
                        <a href="../../../en/search.html?query=process"
                           itemprop="keywords">process</a>
                    
                </nav>
            

            
                <div class="guests" aria-label="Guests">
                    
                        <span itemprop="actor" itemscope itemtype="https://schema.org/Person">
              <a href="../../../en/guests/darren-w-pulsipher/index.html" itemprop="url">
                <span itemprop="name">Darren W Pulsipher</span>
              </a>
            </span>
                    
                        <span itemprop="actor" itemscope itemtype="https://schema.org/Person">
              <a href="../../../en/guests/nick-bhadange/index.html" itemprop="url">
                <span itemprop="name">Nick Bhadange</span>
              </a>
            </span>
                    
                </div>
            
        </section>

        <section class="show-notes" aria-label="Show notes">
            <h2>Why Do We Need Confidential Computing?</h2>
<p>The current computer infrastructure is built with a premium on sharing and openness: the internet is free and data should be free. That’s been a problem when it comes to security. We have implemented some solutions that work well; we know to encrypt data when it’s stored and when it’s in transit.  Despite that, data can be attacked in various ways while it’s being read, analyzed, and used.</p>
<p>Sensitive data remains vulnerable, whether it’s financial, medical, or location data, both from a visibility standpoint and a data integrity standpoint.</p>
<p>In dealing with data in healthcare, there are additional layers of complexity. There are many rules and regulations such as HIPAA, and every state has their own regulations around medical data as well. Despite the complexity and the number of governing parties, confidential computing is possible where you have the ability to share data among parties that inherently don’t trust each other.</p>
<p>For confidentiality, we need to think about a few different factors: data integrity, data confidentiality, and code integrity.</p>
<h2>Critical Data Privacy and Security Problems</h2>
<p>An individual’s healthcare records, especially in the United States, are spread everywhere among doctors, specialists, labs, and hospitals. Most people do not have easy access to their records; it’s next to impossible to create a complete picture of your own health. Confidential computing can help break down these barriers.</p>
<p>First of all, it can ensure that whatever data you share, you can trust that it will be protected from a data integrity standpoint; it’s not going to be modified by anyone. It can be confidential, meaning tokenized or encrypted, but it can still be used for computation. For example, if a party wants to do analytics on some data, they don’t need to know information such as names, dates of birth, or social security numbers. So if those portions of the data can be tokenized or encrypted, they can be shared for analysis as long as the other party is trusted.</p>
<p>This is where security measures such as attestation play a role, so parties can prove their identity. And that attestation can be tied all the way down to the hardware level to the trusted execution environments that the hardware provides. This way, you are not just trusting the transport and endpoint, you are trusting the application and how it will use the data as well.</p>
<p>There are two basic approaches to this. First is application SDK, which means the developer can decide how to partition their code into trusted and untrusted components. The other approach is to have a runtime encryption system which can be built on top of a trusted execution environment, minimizing the effort required to convert a current application into something that can run in that environment.</p>
<p>With a hardware-based trusted execution environment protecting applications and data in use, it becomes very difficult for an unauthorized actor, even if they have physical access to the hardware, root privileges or admin rights to the hypervisor, to gain access to the protected application and data. The confidential computing paradigm aims to allow the removal of even the cloud provider from the trusted computing base. That way, only the hardware and the protected application itself is within the attack boundary.</p>
<p>These computing environments allow the CSPs to leverage the best of what the hardware can offer and the best possible security, over which the end user has absolute control. Each party can determine its own policies and the hierarchies of policies such as state and federal, and each provider of information can determine which policies apply and to whom.</p>
<h2>Real-World Evidence Clinical Study</h2>
<p>Pulling all the data together and making sense of it is a big challenge in the healthcare industry. The number of privacy settings and data sharing settings that are in place among the different providers, devices, geographical locations, etc. makes it currently impossible.</p>
<p>AI-Vets, Intel, and some partners are working together on this problem. The brilliantly simple architecture allows for use across disparate environments, types of data and policies, yet is able to perform centralized analysis.</p>
<p>An example of our implementation is one small proof of concept: How do you analyze across multiple parties such as hospitals, research environments, and labs, each with their own data and trials they may be running in a clinical environment? For example, how can we find any correlation among people who take drug X, say for diabetes, and have condition Y, say cancer, when drug X has nothing to do with the treatment of condition Y? These two sets of data would not be in the same place because they are handled by different providers.</p>
<p>If, however, the providers were part of an ecosystem where they could determine what policies they want to apply at their endpoint, we could have a centralized application, a central research portal, which has connections to these endpoints. There would be third party key management and attestation to verify each other’s credentials and authorizations, so all parties can trust each other.</p>
<p>That’s one aspect of the trust, but we also need to protect the data that will be pulled out, queried, and transmitted. To accomplish this, we can manage data and applications inside secure, encrypted enclaves. The data is handled using the policies each user sets, such as obfuscating birthdays, social security numbers, etc. This information can be tokenized so it turns into complete garbage in unauthorized hands.</p>
<p>The central portal can perform a query that spans multiple endpoints and pulls different types of data together into its runtime system and does an analysis on that. So rather than having to pull everything into a data lake and then doing analysis, it’s done in real time. There is no waiting for data to be published or cleansed first by applying all those policies; it happens dynamically and on the fly.</p>
<p>This allows for tremendous insights. During the pandemic, for example, if we had to wait every day to get the data and run complex analysis on it, that would be hard. If we were able to tap into live data across all these different systems all over the country and around the world, yet be able to share it securely, we could come up with some unique insights that would not be otherwise possible.</p>
<p>We’ve already seen this in some POCs for clinician sites that we did with our partner Fortanix. They have a product line that makes it easy for different entities to define their policies in a confidential computing environment and verify each other’s identities and manage keys and trusts. The concept of trusted execution environments has been around for some time, and it’s gone mainstream, so it’s become easier to leverage. The use cases for this are fantastic.</p>
<h2>Automated COVID-19 Detection from Chest X-ray Images</h2>
<p>In some use cases, it’s not just the data that needs to be secure, but also the intellectual property associated with some specialized algorithms.  For example, to automatically detect COVID from X-ray images, there would be radiological data, patient data, and there may be a proprietary algorithm to do the analysis. The enclaves can protect both the data and the applications from prying eyes.</p>
<p>The secure enclave also protects the other machines in the network because if someone pushed something nefarious out onto the end nodes, the key management system would prevent it from being exchanged because it’s not properly attested. Parties choose exactly which data sources the enclave can talk to and it’s locked down, both from what comes in and goes out.</p>
<h2>Electronic Health Records (eHR)</h2>
<p>Health records are a big mess in the United States, with unenforceable paper HIPAA agreements etc. and everything spread across different entities. A use case that may be a good model for us to follow is from the German government. They have mandated that health care data must be stored in electronic health records, and those applications must be deployed in trusted execution environments. The patient is the end user and determines what data is available and to whom.</p>
<p>That level of granularity in terms of what is available to the end user is tremendous. And not only is all of that data being collected and shared from the different systems, it’s in secure enclaves, so it’s completely secure from the outside world. If someone unauthorized did get access to the data itself, it would be completely meaningless.</p>
<p>These trusted execution environments are the first step in the direction to controls that are easily understandable and easily enforceable. </p>

        </section>

        

    </article>
</main>

<!-- Structured Data -->
<script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "PodcastSeries",
  "@id": "https://www.embracingdigital.org/en/episodes/index.html#series",
  "name": "Embracing Digital Transformation",
  "url": "https://www.embracingdigital.org/en/episodes/index.html",
  "inLanguage": "en",
  "description": "A podcast about the digital transformation of the world.",
  "publisher": {
    "@type": "Organization",
    "@id": "https://www.embracingdigital.org/#org",
    "name": "Embracing Digital Transformation",
    "url": "https://www.embracingdigital.org",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.embracingdigital.org/images/logo.png",
      "width": 512,
      "height": 512
    }
  }
}</script>
<script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "PodcastEpisode",
  "@id": "https://www.embracingdigital.org/en/episodes/edt-40/index.html#episode",
  "url": "https://www.embracingdigital.org/en/episodes/edt-40/index.html",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.embracingdigital.org/en/episodes/edt-40/index.html"
  },
  "name": "Collaborative Medical Research with Confidential Computing",
  "episodeNumber": 40,
  "datePublished": "2021-02-24",
  "inLanguage": "en",
  "description": "Breakdown the barriers to accelerating medical research for the cure to cancer with confidential computing. Nick Bhadange, Technology Specialist, AI-Vets and Darren Pulsipher, Chief Solution Architect, Public Sector, Intel, discuss the need for confidential computing in healthcare and the potential",
  "partOfSeries": {
    "@id": "https://www.embracingdigital.org/en/episodes/index.html#series"
  },
  "author": {
    "@type": "Person",
    "name": "Dr. Darren Pulsipher"
  },
  "creator": {
    "@type": "Person",
    "name": "Dr. Darren Pulsipher"
  },
  "image": {
    "@type": "ImageObject",
    "url": "https://www.embracingdigital.org/en/episodes/edt-40/thumbnail.png"
  },
  "associatedMedia": [
    {
      "@type": "VideoObject",
      "name": "Collaborative Medical Research with Confidential Computing Video",
      "embedUrl": "https://www.youtube.com/embed/url"
    },
    {
      "@type": "AudioObject",
      "name": "Collaborative Medical Research with Confidential Computing Audio",
      "contentUrl": "https://share.transistor.fm/e/embracing-digital-transformation-episode44.html"
    }
  ],
  "actor": [
    {
      "@type": "Person",
      "name": "Darren W Pulsipher",
      "url": "https://www.embracingdigital.org/../../../en/guests/darren-w-pulsipher/index.html"
    },
    {
      "@type": "Person",
      "name": "Nick Bhadange",
      "url": "https://www.embracingdigital.org/../../../en/guests/nick-bhadange/index.html"
    }
  ]
}</script>

<footer id="footer">
    <div class="footer-content">
        <p>Copyright &copy; <span id="y"></span> Paidar Productions LLC</p>
        <p>All rights reserved</p>
    </div>
</footer>

<script>
    // year
    (function(){ var y=document.getElementById('y'); if(y){ y.textContent = new Date().getFullYear(); } })();

    // Guard for pages without nav
    const toggle = document.querySelector('.menu-toggle');
    const nav    = document.querySelector('nav#primary-nav');
    if (nav) {
        // Mobile: toggle .menu-open on <body>
        toggle?.addEventListener('click', () => {
            const open = document.body.classList.toggle('menu-open');
            toggle.setAttribute('aria-expanded', String(open));
        });

        // Dropdowns: tap/click + keyboard
        document.querySelectorAll('li.dropdown > a').forEach(link => {
            const li = link.parentElement;
            const submenu = li.querySelector('.dropdown-menu');

            link.addEventListener('click', (e) => {
                if (!submenu) return;
                e.preventDefault();

                // close others
                document.querySelectorAll('li.dropdown.open > a').forEach(a => {
                    if (a !== link) {
                        a.setAttribute('aria-expanded', 'false');
                        a.parentElement.classList.remove('open');
                    }
                });

                const isOpen = li.classList.toggle('open');
                link.setAttribute('aria-expanded', String(isOpen));
            });

            link.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowDown') { e.preventDefault(); submenu?.querySelector('a')?.focus(); }
                if (e.key === 'Escape')    { li.classList.remove('open'); link.setAttribute('aria-expanded','false'); link.focus(); }
            });
        });

        // Close dropdowns on outside click
        document.addEventListener('click', (e) => {
            if (!e.target.closest('nav')) {
                document.querySelectorAll('li.dropdown.open > a').forEach(a => {
                    a.setAttribute('aria-expanded','false');
                    a.parentElement.classList.remove('open');
                });
            }
        });
    }
</script>

